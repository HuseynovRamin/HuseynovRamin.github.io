<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyWater</title>

<link rel="manifest" href="manifest.json">

<style>
:root {
  --bg:#060b18;
  --card:#0d162f;
  --accent:#4fd1ff;
  --text:#e6f1ff;
  --muted:#7b8dbd;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  overflow-x:hidden;
}

.hidden{display:none}

.center{
  display:flex;
  justify-content:center;
  align-items:center;
}

button{
  background:var(--accent);
  color:#002;
  border:none;
  padding:14px 20px;
  border-radius:16px;
  font-size:16px;
  cursor:pointer;
}

button:disabled{
  opacity:.4;
}

.card{
  background:var(--card);
  margin:16px;
  padding:20px;
  border-radius:20px;
}

h2{margin-top:0}

/* ===== Onboarding ===== */
#onboarding{
  position:fixed;
  inset:0;
  background:var(--bg);
  z-index:10;
}

.step{
  max-width:420px;
  margin:auto;
  padding:24px;
}

.gender-btns button{
  width:48%;
}

.ruler{
  overflow-x:auto;
  display:flex;
  align-items:flex-end;
  height:90px;
  margin:30px 0;
  padding:0 50%;
  scroll-snap-type:x mandatory;
}

.tick{
  width:22px;
  height:30px;
  border-left:2px solid var(--muted);
  position:relative;
  scroll-snap-align:center;
}

.tick.major{height:55px}

.tick span{
  position:absolute;
  top:60px;
  left:-10px;
  font-size:12px;
}

.indicator{
  position:absolute;
  top:0;
  left:50%;
  width:3px;
  height:100%;
  background:var(--accent);
}

.value{
  text-align:center;
  font-size:24px;
}

/* Age wheel */
.age-wheel{
  display:flex;
  overflow-x:auto;
  padding:0 50%;
  scroll-snap-type:x mandatory;
}

.age-item{
  width:60px;
  text-align:center;
  font-size:22px;
  color:var(--muted);
  scroll-snap-align:center;
  cursor:pointer;
}

.age-item.active{
  color:var(--accent);
  font-size:28px;
}

/* ===== App ===== */
#progress{
  height:16px;
  background:#111c3f;
  border-radius:10px;
  overflow:hidden;
}

#progress span{
  display:block;
  height:100%;
  background:var(--accent);
  width:0%;
  transition:.4s;
}

.drinks{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}

.drink{
  background:#111c3f;
  padding:16px;
  border-radius:16px;
  text-align:center;
  cursor:pointer;
}

.drink span{
  font-size:24px;
  display:block;
}

/* Volume modal */
#volumeModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:flex;
  justify-content:center;
  align-items:flex-end;
  z-index:20;
}

#volumeCard{
  background:var(--card);
  width:100%;
  border-radius:20px 20px 0 0;
  padding:20px;
  animation:slideUp .3s ease;
}

@keyframes slideUp{
  from{transform:translateY(100%)}
  to{transform:translateY(0)}
}

.volumes{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}

.volume{
  background:#111c3f;
  padding:14px;
  border-radius:14px;
  text-align:center;
  cursor:pointer;
}

/* Confetti */
.confetti{
  position:fixed;
  width:6px;
  height:6px;
  background:var(--accent);
  animation:fall 2s linear forwards;
}

@keyframes fall{
  to{transform:translateY(100vh) rotate(360deg);opacity:0}
}
</style>
</head>

<body>

<!-- ONBOARDING -->
<div id="onboarding">
  <div class="step" id="stepGender">
    <h2>Choose gender</h2>
    <div class="gender-btns center">
      <button onclick="setGender('male')">Male</button>
      <button onclick="setGender('female')">Female</button>
    </div>
  </div>

  <div class="step hidden" id="stepWeight">
    <h2>Select weight (kg)</h2>
    <div class="value" id="weightVal">60</div>
    <div style="position:relative">
      <div class="indicator"></div>
      <div class="ruler" id="weightRuler"></div>
    </div>
    <button onclick="nextStep()">Next</button>
  </div>

  <div class="step hidden" id="stepHeight">
    <h2>Select height (cm)</h2>
    <div class="value" id="heightVal">170</div>
    <div style="position:relative">
      <div class="indicator"></div>
      <div class="ruler" id="heightRuler"></div>
    </div>
    <button onclick="nextStep()">Next</button>
  </div>

  <div class="step hidden" id="stepAge">
    <h2>Select age</h2>
    <div class="age-wheel" id="ageWheel"></div>
    <button onclick="finishProfile()">Finish</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <div class="card">
    <h2>Today</h2>
    <div id="progress"><span></span></div>
    <p><span id="consumed">0</span> / <span id="goal">0</span> ml</p>
  </div>

  <div class="card">
    <h2>Add drink</h2>
    <div class="drinks">
      <div class="drink" onclick="openDrink('water')"><span>üíß</span>Water</div>
      <div class="drink" onclick="openDrink('coffee')"><span>‚òï</span>Coffee</div>
      <div class="drink" onclick="openDrink('tea')"><span>üçµ</span>Tea</div>
      <div class="drink" onclick="openDrink('soda')"><span>ü•§</span>Soda</div>
      <div class="drink" onclick="openDrink('juice')"><span>üßÉ</span>Juice</div>
      <div class="drink" onclick="openDrink('milk')"><span>ü•õ</span>Milk</div>
    </div>
  </div>
</div>

<!-- VOLUME MODAL -->
<div id="volumeModal" class="hidden" onclick="closeVolume(event)">
  <div id="volumeCard">
    <h3>Select volume</h3>
    <div class="volumes" id="volumeList"></div>
  </div>
</div>

<script>
/* ===== DATA ===== */
const DRINKS={
  water:1,
  coffee:.98,
  tea:.99,
  soda:.93,
  juice:.88,
  milk:.87
};
const VOLUMES=[50,100,150,200,250,300,330,400,500,600,1000];

let profile=JSON.parse(localStorage.getItem("profile"))||{};
let data=JSON.parse(localStorage.getItem("data"))||{};
let today=new Date().toDateString();
if(!data[today]) data[today]={consumed:0};

/* ===== ONBOARDING ===== */
let step=0;
const steps=["stepGender","stepWeight","stepHeight","stepAge"];

function showStep(i){
  steps.forEach(id=>document.getElementById(id).classList.add("hidden"));
  document.getElementById(steps[i]).classList.remove("hidden");
  step=i;
}

function setGender(g){
  profile.gender=g;
  navigator.vibrate?.(20);
  showStep(1);
}

function nextStep(){
  navigator.vibrate?.(20);
  showStep(step+1);
}

function finishProfile(){
  localStorage.setItem("profile",JSON.stringify(profile));
  document.getElementById("onboarding").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
  initApp();
}

/* ===== RULERS ===== */
function buildRuler(el,min,max,val,cb){
  el.innerHTML="";
  el.style.padding="0 50%";
  for(let i=min;i<=max;i++){
    let t=document.createElement("div");
    t.className="tick"+(i%5===0?" major":"");
    t.onclick=()=>snap(i);
    if(i%5===0){
      let s=document.createElement("span");
      s.textContent=i;
      t.appendChild(s);
    }
    el.appendChild(t);
  }
  function snap(v){
    el.scrollLeft=(v-min)*22;
    cb(v);
    navigator.vibrate?.(10);
  }
  el.addEventListener("scroll",()=>{
    let v=min+Math.round(el.scrollLeft/22);
    cb(v);
  });
  snap(val);
}

/* Weight */
buildRuler(weightRuler,30,150,60,v=>{
  weightVal.textContent=v;
  profile.weight=v;
});

/* Height */
buildRuler(heightRuler,100,220,170,v=>{
  heightVal.textContent=v;
  profile.height=v;
});

/* Age */
for(let i=10;i<=90;i++){
  let d=document.createElement("div");
  d.className="age-item";
  d.textContent=i;
  d.onclick=()=>selectAge(i);
  ageWheel.appendChild(d);
}
function selectAge(a){
  profile.age=a;
  ageWheel.scrollLeft=(a-10)*60;
  document.querySelectorAll(".age-item").forEach(e=>{
    e.classList.toggle("active",+e.textContent===a);
  });
  navigator.vibrate?.(10);
}

/* ===== APP ===== */
function initApp(){
  let goal=Math.round(profile.weight*35);
  document.getElementById("goal").textContent=goal;
  updateUI();
  if(Notification.permission!=="granted"){
    Notification.requestPermission();
  }
}

function updateUI(){
  let goal=document.getElementById("goal").textContent;
  let c=data[today].consumed;
  consumed.textContent=Math.round(c);
  let pct=Math.min(100,(c/goal)*100);
  document.querySelector("#progress span").style.width=pct+"%";
  if(c>=goal) confetti();
}

/* ===== DRINKS ===== */
let currentDrink=null;
function openDrink(d){
  currentDrink=d;
  volumeList.innerHTML="";
  VOLUMES.forEach(v=>{
    let div=document.createElement("div");
    div.className="volume";
    div.textContent=v+" ml";
    div.onclick=()=>addDrink(v);
    volumeList.appendChild(div);
  });
  volumeModal.classList.remove("hidden");
}

function closeVolume(e){
  if(e.target.id==="volumeModal") volumeModal.classList.add("hidden");
}

function addDrink(v){
  let water=v*DRINKS[currentDrink];
  data[today].consumed+=water;
  localStorage.setItem("data",JSON.stringify(data));
  navigator.vibrate?.(30);
  volumeModal.classList.add("hidden");
  updateUI();
}

/* ===== CONFETTI ===== */
function confetti(){
  for(let i=0;i<40;i++){
    let c=document.createElement("div");
    c.className="confetti";
    c.style.left=Math.random()*100+"vw";
    c.style.top="-10px";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),2000);
  }
}

/* ===== INIT ===== */
if(profile.gender){
  document.getElementById("onboarding").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
  initApp();
}
</script>
</body>
</html>
