<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Head Volleyball</title>
  <style>
    body {
      margin: 0;
      background: #def5f4;
      font-family: sans-serif;
      text-align: center;
    }
    h1 {
      margin-top: 10px;
    }
    canvas {
      background: #7ed6a2;
      display: block;
      margin: auto;
      border: 4px solid #444;
    }
    #controls {
      margin: 10px;
    }
    #countdown {
      font-size: 40px;
      font-weight: bold;
      color: #222;
    }
  </style>
</head>
<body>
  <h1>üèê Head Volleyball</h1>
  <div id="controls">
    <button onclick="startGame('ai')">Play vs AI</button>
    <button onclick="startGame('2p')">2 Player</button>
  </div>
  <div id="countdown"></div>
  <canvas id="game" width="900" height="500"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const countdownEl = document.getElementById("countdown");

    let player1 = { x: 150, y: 350, vy: 0, onGround: false, score: 0 };
    let player2 = { x: 650, y: 350, vy: 0, onGround: false, score: 0 };
    let ball = { x: 450, y: 250, vx: 3, vy: 2, radius: 25 };

    let keys = {};
    let gameMode = "ai";
    let gameStarted = false;

    const gravity = 0.4;
    const groundY = 400;
    const netX = 450;

    const p1Img = new Image();
    const p2Img = new Image();
    const ballImg = new Image();

    p1Img.src = "data:image/png;base64,{{PLAYER1}}";
    p2Img.src = "data:image/png;base64,{{PLAYER2}}";
    ballImg.src = "data:image/png;base64,{{BALL}}";

    document.addEventListener("keydown", (e) => (keys[e.key] = true));
    document.addEventListener("keyup", (e) => (keys[e.key] = false));

    function drawPlayer(player, img) {
      ctx.drawImage(img, player.x, player.y, 80, 80);
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.closePath();
      ctx.drawImage(ballImg, ball.x - ball.radius, ball.y - ball.radius, 50, 50);
    }

    function startGame(mode) {
      gameMode = mode;
      player1.score = 0;
      player2.score = 0;
      countdown(3);
    }

    function countdown(num) {
      if (num === 0) {
        countdownEl.innerText = "";
        gameStarted = true;
        requestAnimationFrame(update);
        return;
      }
      countdownEl.innerText = num;
      setTimeout(() => countdown(num - 1), 1000);
    }

    function resetBall() {
      ball.x = 450;
      ball.y = 250;
      ball.vx = (Math.random() > 0.5 ? 1 : -1) * 3;
      ball.vy = 2;
    }

    function update() {
      if (!gameStarted) return;

      // Move players
      const speed = 5;
      // Player 1
      if (keys["a"]) player1.x -= speed;
      if (keys["d"]) player1.x += speed;
      if (keys["w"] && player1.onGround) {
        player1.vy = -10;
        player1.onGround = false;
      }

      // Player 2 or AI
      if (gameMode === "2p") {
        if (keys["ArrowLeft"]) player2.x -= speed;
        if (keys["ArrowRight"]) player2.x += speed;
        if (keys["ArrowUp"] && player2.onGround) {
          player2.vy = -10;
          player2.onGround = false;
        }
      } else {
        if (ball.x > player2.x + 40) player2.x += speed * 0.6;
        else if (ball.x < player2.x + 40) player2.x -= speed * 0.6;
        if (ball.y < 200 && player2.onGround) {
          player2.vy = -10;
          player2.onGround = false;
        }
      }

      // Physics for jumping
      [player1, player2].forEach((p) => {
        p.y += p.vy;
        p.vy += gravity;
        if (p.y >= groundY) {
          p.y = groundY;
          p.vy = 0;
          p.onGround = true;
        }
      });

      // Ball physics
      ball.x += ball.vx * 0.8;
      ball.y += ball.vy * 0.8;
      ball.vy += gravity;

      // Ball bouncing off floor
      if (ball.y + ball.radius > groundY + 25) {
        if (ball.x < netX) player2.score++;
        else player1.score++;
        resetBall();
      }

      // Ball bouncing off ceiling
      if (ball.y < 0) ball.vy *= -1;

      // Wall collision
      if (ball.x < ball.radius || ball.x > canvas.width - ball.radius)
        ball.vx *= -1;

      // Collision with players
      [player1, player2].forEach((p) => {
        const dx = ball.x - (p.x + 40);
        const dy = ball.y - (p.y + 40);
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 50) {
          ball.vx = dx * 0.2;
          ball.vy = dy * 0.2;
        }
      });

      // Drawing
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(netX - 5, 300, 10, 100); // net

      drawPlayer(player1, p1Img);
      drawPlayer(player2, p2Img);
      drawBall();

      // Score
      ctx.fillStyle = "#000";
      ctx.font = "20px sans-serif";
      ctx.fillText(`Player 1: ${player1.score}`, 30, 30);
      ctx.fillText(`Player 2: ${player2.score}`, 750, 30);

      requestAnimationFrame(update);
    }
  </script>
</body>
</html>
