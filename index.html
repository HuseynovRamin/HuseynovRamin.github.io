<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Waterify</title>

<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --bg:#060b18;
  --card:#121a2f;
  --accent:#4fd1ff;
  --text:#fff;
  --muted:#9aa4bf;
}
*{box-sizing:border-box;font-family:Poppins}
body{margin:0;background:radial-gradient(circle at top,#162044,#060b18);color:var(--text)}

.app{max-width:420px;margin:auto;padding:16px 16px 100px}
.card{background:linear-gradient(180deg,#151f3f,#0f1630);border-radius:26px;padding:18px;margin-bottom:16px}

button{
  width:100%;
  padding:14px;
  border-radius:16px;
  border:none;
  background:linear-gradient(135deg,#4fd1ff,#6b7cff);
  font-weight:700;
  cursor:pointer;
}

.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:50;
}

.bottle{
  width:140px;height:260px;margin:12px auto;
  border-radius:34px;
  border:3px solid rgba(255,255,255,.25);
  overflow:hidden;position:relative;
}
.water{
  position:absolute;bottom:0;width:100%;
  height:0%;
  background:linear-gradient(180deg,#7be7ff,#3fa9f5);
  transition:height .5s ease;
}

/* ===== RULER ===== */
.rwrap{position:relative;height:90px;margin-top:10px}
.center{position:absolute;left:50%;top:0;bottom:0;width:2px;background:#ff4d4d}
.ruler{
  display:flex;
  overflow-x:auto;
  scrollbar-width:none;
  scroll-snap-type:x mandatory;
}
.ruler::-webkit-scrollbar{display:none}
.tick{
  width:20px;
  flex-shrink:0;
  scroll-snap-align:center;
  position:relative;
}
.tick:after{
  content:"";
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:2px;height:28px;
  background:rgba(255,255,255,.4);
}
.tick.major:after{height:44px;background:#fff}
.tick span{
  position:absolute;
  top:-22px;
  left:50%;
  transform:translateX(-50%);
  font-size:.75rem;
  color:var(--muted);
}

/* AGE WHEEL */
.age-wheel{
  display:flex;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
}
.age-wheel::-webkit-scrollbar{display:none}
.age-item{
  min-width:56px;
  text-align:center;
  scroll-snap-align:center;
  font-size:1.6rem;
  color:var(--muted);
}
.age-item.active{
  color:var(--accent);
  font-weight:700;
  transform:scale(1.25);
}

/* NAV */
.nav{
  position:fixed;bottom:0;left:0;right:0;
  background:#0b1228;
  display:flex;justify-content:space-around;
  padding:12px 0;
}
.nav i{font-size:1.3rem;color:var(--muted)}
</style>
</head>

<body>

<div class="app">
  <div class="card">
    <h2 style="text-align:center">Today</h2>
    <div class="bottle"><div class="water" id="water"></div></div>
    <div id="consumed" style="text-align:center">0 ml</div>
    <div id="goal" style="text-align:center;font-weight:700"></div>
    <button onclick="openDrinkPicker()">Add Water</button>
  </div>
</div>

<!-- ONBOARDING -->
<div class="modal" id="onboarding">
  <div class="card" style="width:90%;max-width:360px" id="step"></div>
</div>

<!-- NAV -->
<div class="nav">
  <i class="fa-solid fa-droplet"></i>
  <i class="fa-solid fa-user" onclick="startOnboarding()"></i>
</div>

<script>
/* ===== STATE ===== */
let profile = JSON.parse(localStorage.getItem('profile'));
let stepIndex = 0;
let consumed = 0;

/* ===== ONBOARDING STEPS ===== */
const steps = [
  { render: () => `
    <h2>Select Gender</h2>
    <button onclick="setGender('male')">Male</button>
    <button onclick="setGender('female')">Female</button>
  `},
  { render: () => rulerStep('Weight (kg)', 30, 200, 'weight') },
  { render: () => rulerStep('Height (cm)', 100, 220, 'height') },
  { render: () => ageStep() }
];

function startOnboarding(){
  profile = {gender:null,weight:70,height:170,age:18};
  stepIndex = 0;
  onboarding.style.display = 'flex';
  renderStep();
}

function renderStep(){
  step.innerHTML = steps[stepIndex].render();
}

/* ===== GENDER ===== */
function setGender(g){
  profile.gender = g;
  next();
}

/* ===== RULER ===== */
function rulerStep(label,min,max,key){
  setTimeout(()=>initRuler(min,max,key),0);
  return `
    <h2>${label}</h2>
    <div class="rwrap">
      <div class="center"></div>
      <div class="ruler" id="ruler"></div>
    </div>
    <button onclick="next()">Next</button>
  `;
}

function initRuler(min,max,key){
  const r=document.getElementById('ruler');
  r.innerHTML='';
  for(let i=min;i<=max;i++){
    const t=document.createElement('div');
    t.className='tick'+(i%5===0?' major':'');
    if(i%5===0){const s=document.createElement('span');s.textContent=i;t.appendChild(s);}
    r.appendChild(t);
  }
  r.scrollLeft=(profile[key]-min)*20;
  r.addEventListener('scroll',()=>{
    const v=Math.round(r.scrollLeft/20)+min;
    profile[key]=Math.max(min,Math.min(max,v));
  });
}

/* ===== AGE ===== */
function ageStep(){
  setTimeout(initAge,0);
  return `
    <h2>Select Age</h2>
    <div class="age-wheel" id="age"></div>
    <button onclick="finish()">Finish</button>
  `;
}

function initAge(){
  const a=document.getElementById('age');
  a.innerHTML='';
  for(let i=10;i<=80;i++){
    const d=document.createElement('div');
    d.className='age-item'+(i===profile.age?' active':'');
    d.textContent=i;
    a.appendChild(d);
  }
  a.scrollLeft=(profile.age-10)*56;
  a.addEventListener('scroll',()=>{
    const v=Math.round(a.scrollLeft/56)+10;
    profile.age=v;
    document.querySelectorAll('.age-item').forEach(e=>{
      e.classList.toggle('active',+e.textContent===v);
    });
  });
}

/* ===== FLOW ===== */
function next(){stepIndex++;renderStep()}
function finish(){
  localStorage.setItem('profile',JSON.stringify(profile));
  onboarding.style.display='none';
  updateUI();
}

/* ===== HYDRATION ===== */
function goalCalc(){return Math.round(profile.weight*35)}
function updateUI(){
  const g=goalCalc();
  goal.textContent=`Goal: ${g} ml`;
  consumed.textContent=`${consumed} ml`;
  water.style.height=(consumed/g*100)+'%';
}

function openDrinkPicker(){
  consumed+=250;
  updateUI();
}

/* ===== INIT ===== */
if(!profile || !profile.gender){
  startOnboarding();
}else{
  updateUI();
}
</script>
</body>
</html>
