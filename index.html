<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyWater</title>

<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --bg:#060b18;--card:#121a2f;--accent:#4fd1ff;
  --text:#fff;--muted:#9aa4bf;--danger:#ff4d4d;
}
*{box-sizing:border-box;font-family:Poppins}
body{margin:0;background:radial-gradient(circle at top,#162044,#060b18);color:var(--text)}

.app{max-width:420px;margin:auto;padding:16px 16px 120px}
.card{background:linear-gradient(180deg,#151f3f,#0f1630);border-radius:26px;padding:18px;margin-bottom:16px}

h2{text-align:center;margin-top:0}

button{
  width:100%;padding:14px;border-radius:16px;border:none;
  background:linear-gradient(135deg,#4fd1ff,#6b7cff);
  font-weight:700;cursor:pointer;
}

.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.7);
  display:none;align-items:center;justify-content:center;z-index:50;
}

.bottle{
  width:140px;height:260px;margin:12px auto;
  border-radius:34px;border:3px solid rgba(255,255,255,.25);
  overflow:hidden;position:relative;
}
.water{
  position:absolute;bottom:0;width:100%;
  height:0%;background:linear-gradient(180deg,#7be7ff,#3fa9f5);
  transition:height .6s ease;
}

/* RULER */
.rwrap{position:relative;height:100px}
.center{position:absolute;left:50%;top:0;bottom:0;width:2px;background:var(--danger)}
.ruler{
  display:flex;overflow-x:auto;scroll-snap-type:x mandatory;
  scrollbar-width:none;padding:0 50%;
}
.ruler::-webkit-scrollbar{display:none}
.tick{
  width:22px;flex-shrink:0;scroll-snap-align:center;position:relative;
}
.tick:after{
  content:"";position:absolute;bottom:0;left:50%;
  transform:translateX(-50%);width:2px;height:30px;
  background:rgba(255,255,255,.4);
}
.tick.major:after{height:46px;background:#fff}
.tick span{
  position:absolute;top:-24px;left:50%;
  transform:translateX(-50%);font-size:.75rem;color:var(--muted);
}

/* AGE */
.age-wheel{
  display:flex;overflow-x:auto;scroll-snap-type:x mandatory;
  padding:0 50%;scrollbar-width:none;
}
.age-wheel::-webkit-scrollbar{display:none}
.age-item{
  min-width:60px;text-align:center;
  scroll-snap-align:center;font-size:1.6rem;color:var(--muted);
  cursor:pointer;
}
.age-item.active{
  color:var(--accent);font-weight:700;transform:scale(1.3);
}

/* NAV */
.nav{
  position:fixed;bottom:0;left:0;right:0;
  background:#0b1228;display:flex;justify-content:space-around;
  padding:12px 0;
}
.nav i{font-size:1.4rem;color:var(--muted);cursor:pointer}

/* CONFETTI */
.confetti{
  position:fixed;width:8px;height:8px;border-radius:50%;
  animation:fall 2s linear forwards;
}
@keyframes fall{
  to{transform:translateY(100vh) rotate(360deg);opacity:0}
}
</style>
</head>

<body>

<div class="app">
  <div class="card">
    <h2>ðŸ’§ Welcome back</h2>
    <div class="bottle"><div class="water" id="water"></div></div>
    <div id="consumed" style="text-align:center">0 ml</div>
    <div id="goal" style="text-align:center;font-weight:700"></div>

    <button onclick="openDrinkPicker('water')">
      <i class="fa-solid fa-droplet"></i> Add Drink
    </button>

    <div id="streak" style="text-align:center;margin-top:10px"></div>
  </div>
</div>

<!-- DRINK PICKER -->
<div class="modal" id="drinkModal">
  <div class="card" style="width:90%;max-width:360px">
    <h2>Add Drink</h2>
    <button onclick="addDrink('water',250)"><i class="fa-solid fa-droplet"></i> Water 250ml</button>
    <button onclick="addDrink('coffee',200)"><i class="fa-solid fa-mug-hot"></i> Coffee</button>
    <button onclick="addDrink('tea',200)"><i class="fa-solid fa-leaf"></i> Tea</button>
    <button onclick="addDrink('soda',330)"><i class="fa-solid fa-bottle-water"></i> Soda</button>
    <button onclick="addDrink('juice',250)"><i class="fa-solid fa-glass-water"></i> Juice</button>
    <button onclick="addDrink('milk',250)"><i class="fa-solid fa-cow"></i> Milk</button>
    <button onclick="closeDrink()">Close</button>
  </div>
</div>

<div class="nav">
  <i class="fa-solid fa-user" onclick="startOnboarding()"></i>
  <i class="fa-solid fa-droplet" onclick="openDrinkPicker('water')"></i>
</div>

<script>
/* ================= STATE ================= */
let profile = JSON.parse(localStorage.getItem('profile'));
let data = JSON.parse(localStorage.getItem('data')) || {};
let today = new Date().toDateString();

if(!data[today]) data[today]={consumed:0,goal:false};

const DRINKS={
  water:1, coffee:0.98, tea:0.99, soda:0.93, juice:0.88, milk:0.87
};

/* ================= UTIL ================= */
const haptic=l=>navigator.vibrate&&navigator.vibrate(l);
const goalCalc=()=>Math.round(profile.weight*35);

/* ================= UI ================= */
function updateUI(){
  const g=goalCalc();
  const c=data[today].consumed;
  goal.textContent=`Goal: ${g} ml`;
  consumed.textContent=`${Math.round(c)} ml`;
  water.style.height=Math.min(c/g*100,100)+'%';

  streak.textContent=`ðŸ”¥ Streak: ${profile.streak||0} days`;

  if(c>=g && !data[today].goal){
    data[today].goal=true;
    profile.streak=(profile.streak||0)+1;
    confetti();
    haptic([20,40,20]);
    localStorage.setItem('profile',JSON.stringify(profile));
  }
  localStorage.setItem('data',JSON.stringify(data));
}

/* ================= DRINKS ================= */
function openDrinkPicker(){drinkModal.style.display='flex'}
function closeDrink(){drinkModal.style.display='none'}

function addDrink(type,ml){
  data[today].consumed+=ml*DRINKS[type];
  haptic(20);
  closeDrink();
  updateUI();
}

/* ================= CONFETTI ================= */
function confetti(){
  for(let i=0;i<80;i++){
    const c=document.createElement('div');
    c.className='confetti';
    c.style.left=Math.random()*100+'vw';
    c.style.top='-10px';
    c.style.background=`hsl(${Math.random()*360},100%,50%)`;
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),2000);
  }
}

/* ================= INIT ================= */
if(!profile){
  alert("Welcome! Please set up your profile.");
}else{
  updateUI();
}
</script>

</body>
</html>
